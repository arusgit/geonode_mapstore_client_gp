(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[78384],{858979:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>T});var r=t(621413),o=t(660904),i=t(532056),l=t(143450),a=t(638601),u=t(344485),c=t(883900),s=t(472568),f=t(420429),d=t(745332),p=t(644001),g=t(405254),v=t(160629),y=t(218157),m=t(485662),Z=t(35961),h=t(753577),b=t(550172),w=t(637453),D=t(379853);function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}var I=["center","cameraPosition"];function C(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return S(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?S(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function P(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function A(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?P(Object(t),!0).forEach((function(n){E(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function E(e,n,t){return(n=function(e){var n=function(e){if("object"!=O(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,"string");if("object"!=O(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==O(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const T=function(e){var n,t,O,S,P,E,T,N,R,j,_=e.map,L=e.selectedId,k=e.views,F=e.apiRef,z=void 0===F?function(){}:F,B=e.showViewsGeometries,V=e.showClipGeometries,x=e.resources,U=null==k?void 0:k.find((function(e){return e.id===L})),G=(0,r.useRef)(),M=(0,r.useRef)(),Y=(0,r.useRef)(),q=(0,r.useRef)(),K=(0,r.useRef)();return(0,r.useEffect)((function(){var e={options:{settings:[D.so.DESCRIPTION,D.so.POSITION,D.so.ANIMATION,D.so.MASK,D.so.GLOBE_TRANSLUCENCY,D.so.LAYERS_OPTIONS],unsupportedLayers:[],showClipGeometriesEnabled:!0},getView:function(){var e=_.camera.positionCartographic,n=(0,D.GM)(e.height),t=_.camera.computeViewRectangle(_.scene.globe.ellipsoid,new l.Z),r=_.scene.globe.pick(new a.Z(_.camera.position,_.camera.direction),_.scene);r||(r=o.Z.add(o.Z.clone(_.camera.position),o.Z.multiplyByScalar(o.Z.clone(_.camera.direction),1e5,new o.Z),new o.Z));var c=i.Z.fromCartesian(new o.Z(r.x,r.y,r.z));return{zoom:n,center:{longitude:u.Z.toDegrees(c.longitude),latitude:u.Z.toDegrees(c.latitude),height:c.height},cameraPosition:{longitude:u.Z.toDegrees(e.longitude),latitude:u.Z.toDegrees(e.latitude),height:e.height},bbox:[u.Z.toDegrees(t.west),u.Z.toDegrees(t.south),u.Z.toDegrees(t.east),u.Z.toDegrees(t.north)]}},setView:function(e){var n=function(e,n){var t=n.center,r=n.cameraPosition,l=function(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(n.includes(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.includes(t)||{}.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}(n,I);if(l.orientation&&l.position)return{destination:l.position,orientation:l.orientation};var a,u={position:o.Z.clone(e.camera.position),orientation:{heading:e.camera.heading,pitch:e.camera.pitch,roll:e.camera.roll}},c=i.Z.toCartesian(i.Z.fromDegrees(t.longitude,t.latitude,t.height,new i.Z)),s=i.Z.toCartesian(i.Z.fromDegrees(t.longitude,t.latitude,t.height+1,new i.Z)),f=i.Z.toCartesian(i.Z.fromDegrees(r.longitude,r.latitude,r.height,new i.Z)),d=i.Z.toCartesian(i.Z.fromDegrees(r.longitude,r.latitude,r.height+1,new i.Z)),p=o.Z.subtract(f,c,new o.Z),g=o.Z.subtract(s,c,new o.Z),v=t.latitude>0&&Math.round((0,w.tj)(p,g))<=5?o.Z.subtract(f,d,new o.Z):o.Z.subtract(d,f,new o.Z);a=o.Z.subtract(c,f,new o.Z),o.Z.normalize(a,a),e.camera.setView({destination:f,orientation:{direction:a,up:v}}),e.camera.setView({destination:f,orientation:{direction:a,up:v}});var y={destination:{x:e.camera.position.x,y:e.camera.position.y,z:e.camera.position.z},orientation:{heading:e.camera.heading,pitch:e.camera.pitch,roll:e.camera.roll}};return e.camera.setView({destination:u.position,orientation:u.orientation}),y}(_,e),t=n.destination,r=n.orientation;_.camera.cancelFlight(),_.camera[e.flyTo?"flyTo":"setView"]({destination:t,orientation:r})},computeViewCoordinates:function(n,t){e.setView(A(A({},t),{},{flyTo:!1}));var r=_.camera.positionCartographic,o=(0,D.GM)(r.height),i=_.camera.computeViewRectangle(_.scene.globe.ellipsoid,new l.Z);return A(A({},t),{},{zoom:o,bbox:[u.Z.toDegrees(i.west),u.Z.toDegrees(i.south),u.Z.toDegrees(i.east),u.Z.toDegrees(i.north)]})}};z(e)}),[_]),(0,r.useEffect)((function(){return _&&(G.current=new c.Z({destroyPrimitives:!0}),_.scene.primitives.add(G.current),M.current=new s.Z,_.scene.primitives.add(M.current),Y.current=new f.Z,_.scene.primitives.add(Y.current),q.current=(0,b.xB)(16,{stroke:"#ffffff",strokeWidth:2,fill:!1}),K.current=new d.Z("clipGeometriesDataSource")),function(){null!=_&&_.isDestroyed&&!_.isDestroyed()&&((0,b.U2)(_,G.current),G.current=null,(0,b.U2)(_,M.current),M.current=null,(0,b.U2)(_,Y.current),Y.current=null)}}),[_]),(0,r.useEffect)((function(){return(B||V)&&null!=_&&_.isDestroyed&&!_.isDestroyed()&&(null==k?void 0:k.length)>0&&(B&&k.forEach((function(e){var n=i.Z.toCartesian(i.Z.fromDegrees(e.cameraPosition.longitude,e.cameraPosition.latitude,e.cameraPosition.height)),t=i.Z.toCartesian(i.Z.fromDegrees(e.center.longitude,e.center.latitude,e.center.height)),r=e.id===L;G.current.add((0,b.c4)({color:r?"#ffcc33":"#ffffff",opacity:1,depthFailColor:"#000000",depthFailOpacity:0,width:1,dashLength:10,coordinates:[n,t]})),M.current.add({position:n,image:q.current,color:(0,b.KF)({color:r?"#ffcc33":"#ffffff"}),disableDepthTestDistance:Number.POSITIVE_INFINITY,allowPicking:!1}),Y.current.add({position:n,text:e.title,font:"12px sans-serif",disableDepthTestDistance:Number.POSITIVE_INFINITY,fillColor:(0,b.KF)({color:"#ffffff"}),outlineColor:(0,b.KF)({color:"#000000"}),outlineWidth:4,style:p.Z.FILL_AND_OUTLINE,showBackground:!1,backgroundPadding:new g.Z(4,4),pixelOffset:new g.Z(0,-16),horizontalOrigin:v.Z.CENTER,verticalOrigin:y.Z.BASELINE})})),V&&x.filter((function(e){var n,t,r=!(null==k||!k.find((function(n){var t,r;return(null==n||null===(t=n.terrain)||void 0===t?void 0:t.clippingLayerResourceId)===e.id||(null==n||null===(r=n.layers)||void 0===r?void 0:r.find((function(n){return(null==n?void 0:n.clippingLayerResourceId)===e.id})))})));return!(null==e||null===(n=e.data)||void 0===n||null===(t=n.collection)||void 0===t||!t.features||!r)})).forEach((function(e){(0,D.er)(e.data.collection.features).forEach((function(e){G.current.add((0,b.c4)({color:"#ff0000",opacity:1,width:3,dashLength:10,clampToGround:!0,coordinates:o.Z.fromDegreesArray(e.geometry.coordinates[0].reduce((function(e,n){return[].concat(C(e),C(n))}),[]))})),Y.current.add({position:o.Z.fromDegreesArray(e.geometry.coordinates[0][0])[0],text:e.id,font:"12px sans-serif",disableDepthTestDistance:Number.POSITIVE_INFINITY,fillColor:(0,b.KF)({color:"#ffffff"}),outlineColor:(0,b.KF)({color:"#000000"}),outlineWidth:4,style:p.Z.FILL_AND_OUTLINE,showBackground:!1,backgroundPadding:new g.Z(4,4),pixelOffset:new g.Z(0,-16),horizontalOrigin:v.Z.CENTER,verticalOrigin:y.Z.BASELINE})}))})),_.scene.requestRender()),function(){var e,n,t;null!=_&&_.isDestroyed&&!_.isDestroyed()&&(null===(e=G.current)||void 0===e||e.removeAll(),null===(n=M.current)||void 0===n||n.removeAll(),null===(t=Y.current)||void 0===t||t.removeAll(),_.scene.requestRender())}}),[k,L,_,B,V,x]),(0,r.useEffect)((function(){var e,n,t,r,o,i,l=_.scene.globe,a=(U||{}).globeTranslucency,u=void 0===a?{}:a;l.translucency.frontFaceAlphaByDistance=new m.Z(null!==(e=null==U||null===(n=U.globeTranslucency)||void 0===n?void 0:n.nearDistance)&&void 0!==e?e:D.Ih.TRANSLUCENCY_NEAR_DISTANCE,0,null!==(t=null==U||null===(r=U.globeTranslucency)||void 0===r?void 0:r.farDistance)&&void 0!==t?t:D.Ih.TRANSLUCENCY_FAR_DISTANCE,1);var c=null!==(o=null==u?void 0:u.opacity)&&void 0!==o?o:D.Ih.TRANSLUCENCY_OPACITY;return l.translucency.enabled=null!==(i=null==u?void 0:u.enabled)&&void 0!==i&&i,l.translucency.frontFaceAlphaByDistance.nearValue=c,l.translucency.frontFaceAlphaByDistance.farValue=null!=u&&u.fadeByDistance?1:c,_.scene.requestRender(),function(){null!=_&&_.isDestroyed&&!_.isDestroyed()&&(l.translucency.enabled=!1)}}),[null==U||null===(n=U.globeTranslucency)||void 0===n?void 0:n.enabled,null==U||null===(t=U.globeTranslucency)||void 0===t?void 0:t.fadeByDistance,null==U||null===(O=U.globeTranslucency)||void 0===O?void 0:O.nearDistance,null==U||null===(S=U.globeTranslucency)||void 0===S?void 0:S.farDistance,null==U||null===(P=U.globeTranslucency)||void 0===P?void 0:P.opacity]),(0,r.useEffect)((function(){var e,n=_.scene;return n.invertClassification=!(null==U||null===(e=U.mask)||void 0===e||!e.enabled),n.invertClassificationColor=new Z.Z(0,0,0,0),function(){null!=_&&_.isDestroyed&&!_.isDestroyed()&&(n.invertClassification=!1)}}),[null==U||null===(E=U.mask)||void 0===E?void 0:E.enabled]),(0,r.useEffect)((function(){var e,n,t,r,o,i=_.scene.globe,l=null==x||null===(e=x.find((function(e){var n;return e.id===(null==U||null===(n=U.terrain)||void 0===n?void 0:n.clippingLayerResourceId)})))||void 0===e?void 0:e.data,a=null===(n=(0,D.er)(null==l||null===(t=l.collection)||void 0===t?void 0:t.features))||void 0===n?void 0:n.find((function(e){var n;return e.id===(null==U||null===(n=U.terrain)||void 0===n?void 0:n.clippingPolygonFeatureId)}));return a?(0,b.ir)(a,!(null==U||null===(r=U.terrain)||void 0===r||!r.clippingPolygonUnion),null==U||null===(o=U.terrain)||void 0===o?void 0:o.clipOriginalGeometry).then((function(e){var n;i.clippingPlanes=new h.Z({planes:e,edgeWidth:1,edgeColor:Z.Z.WHITE,unionClippingRegions:!(null==U||null===(n=U.terrain)||void 0===n||!n.clippingPolygonUnion)}),i.backFaceCulling=!0,i.showSkirts=!0,_.scene.requestRender()})):(i.clippingPlanes=new h.Z({planes:[]}),_.scene.requestRender()),function(){null!=_&&_.isDestroyed&&!_.isDestroyed()&&(i.clippingPlanes=new h.Z({planes:[]}),_.scene.requestRender())}}),[null==U||null===(T=U.terrain)||void 0===T?void 0:T.clippingPolygonFeatureId,null==U||null===(N=U.terrain)||void 0===N?void 0:N.clippingPolygonUnion,null==U||null===(R=U.terrain)||void 0===R?void 0:R.clipOriginalGeometry,null==U||null===(j=U.terrain)||void 0===j?void 0:j.clippingLayerResourceId,x]),null}},637453:(e,n,t)=>{"use strict";t.d(n,{eN:()=>p,tj:()=>g,Ys:()=>v,bj:()=>y,Qg:()=>m,nz:()=>Z,Qk:()=>b,vZ:()=>w,g7:()=>D,Rk:()=>O});var r=t(660904),o=t(344485),i=t(405254),l=t(532056),a=t(835189),u=t(509187),c=t.n(u);function s(e,n){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},s(e,n)}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(f=function(){return!!e})()}function d(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function p(e,n){var t=r.Z.subtract(n,e,new r.Z),o=r.Z.multiplyByScalar(t,.5,new r.Z);return r.Z.add(e,o,new r.Z)}function g(e,n){var t=r.Z.normalize(e,new r.Z),i=r.Z.normalize(n,new r.Z),l=r.Z.dot(t,i);return o.Z.toDegrees(Math.acos(l))}function v(e){return e.map((function(n,t){var o=e[t-1],i=e[t+1];return o&&i?g(r.Z.subtract(o,n,new r.Z),r.Z.subtract(i,n,new r.Z)):null})).filter((function(e){return null!==e}))}function y(e){return new r.Z((e[0].x+e[1].x+e[2].x)/3,(e[0].y+e[1].y+e[2].y)/3,(e[0].z+e[1].z+e[2].z)/3)}function m(e,n){return e.map((function(t,o){var i=e[o-1],l=e[o+1];if(i&&l){var a=function(e,n){var t=r.Z.normalize(e,new r.Z),o=r.Z.normalize(n,new r.Z);return r.Z.cross(t,o,new r.Z)}(r.Z.subtract(i,t,new r.Z),r.Z.subtract(l,t,new r.Z)),u=-Math.sign(r.Z.dot(a,r.Z.subtract(t,n,new r.Z),new r.Z));return g(r.Z.multiplyByScalar(a,u,new r.Z),t)}return null})).filter((function(e){return null!==e}))}function Z(e,n){if((null==e?void 0:e.length)<3)return 0;for(var t=i.Z.packArray(e),o=c()(t,n,2),l=0,a=0;a<o.length;a+=3){var u=e[o[a]],s=e[o[a+1]],f=e[o[a+2]],d=r.Z.subtract(s,u,new r.Z),p=r.Z.subtract(f,u,new r.Z),g=r.Z.cross(d,p,new r.Z);l+=r.Z.magnitude(g)/2}return l}function h(e,n){var t,r=[e,n].map((function(e){return l.Z.fromCartesian(e)}));return function(e,n,t){if(f())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,n);var o=new(e.bind.apply(e,r));return t&&s(o,t.prototype),o}(a.Z,(t=r.map((function(e){var n=e.longitude,t=e.latitude;return new l.Z(n,t,0)})),function(e){if(Array.isArray(e))return d(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,n){if(e){if("string"==typeof e)return d(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?d(e,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).surfaceDistance}function b(e,n){return(null==e?void 0:e.length)<2?0:e.reduce((function(t,o,i){return e[i-1]?t+(n?h(o,e[i-1]):r.Z.distance(o,e[i-1])):t}),0)}function w(e){return Math.sign(l.Z.fromCartesian(e[1]).height-l.Z.fromCartesian(e[0]).height)}function D(e,n){var t=l.Z.fromCartesian(e),r=t.longitude,i=t.latitude,a=t.height;return[o.Z.toDegrees(r),o.Z.toDegrees(i),null!=n?n:a]}function O(e,n){var t=e.map((function(e){return l.Z.fromCartesian(e)})),r=n?n(t):0;return t.map((function(e){var n=e.longitude,t=e.latitude;return l.Z.toCartesian(new l.Z(n,t,r))}))}}}]);