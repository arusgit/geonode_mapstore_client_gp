(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[79589],{43982:(i,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>A});var n=t(621413),o=t(532056),r=t(809069),a=t(271533),l=t(883900),s=t(472568),c=t(604274),d=t(163882),u=t(759398),v=t(958913),f=t(344485),h=t(550172),m=t(637453),y=t(823493),p=t.n(y),g=t(747037),_=t.n(g),b=t(433353),P=t(854788);function w(i){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},w(i)}function I(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,T(n.key),n)}}function C(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.push.apply(t,n)}return t}function Z(i){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?C(Object(t),!0).forEach((function(e){O(i,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(t,e))}))}return i}function O(i,e,t){return(e=T(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function T(i){var e=function(i){if("object"!=w(i)||!i)return i;var e=i[Symbol.toPrimitive];if(void 0!==e){var t=e.call(i,"string");if("object"!=w(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(i);return"symbol"==w(e)?e:e+""}function E(i){return function(i){if(Array.isArray(i))return S(i)}(i)||function(i){if("undefined"!=typeof Symbol&&null!=i[Symbol.iterator]||null!=i["@@iterator"])return Array.from(i)}(i)||D(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(i,e){if(i){if("string"==typeof i)return S(i,e);var t={}.toString.call(i).slice(8,-1);return"Object"===t&&i.constructor&&(t=i.constructor.name),"Map"===t||"Set"===t?Array.from(i):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?S(i,e):void 0}}function S(i,e){(null==e||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function N(i,e){var t;if(null===(null==e?void 0:e.geometry))return null;var n=e.geometry,r=void 0===n?{}:n,a=r.coordinates,l=void 0===a?[]:a;switch(i||(null==r?void 0:r.type)){case"Point":case"Circle":return[o.Z.toCartesian((t=o.Z).fromDegrees.apply(t,E(l)))];case"LineString":return l.map((function(i){var e;return o.Z.toCartesian((e=o.Z).fromDegrees.apply(e,E(i)))}));case"Polygon":return l[0].map((function(i){var e;return o.Z.toCartesian((e=o.Z).fromDegrees.apply(e,E(i)))}));default:return null}}function k(i){return i.map((function(i){var e,t,n=(t=3,function(i){if(Array.isArray(i))return i}(e=i)||function(i,e){var t=null==i?null:"undefined"!=typeof Symbol&&i[Symbol.iterator]||i["@@iterator"];if(null!=t){var n,o,r,a,l=[],s=!0,c=!1;try{if(r=(t=t.call(i)).next,0===e){if(Object(t)!==t)return;s=!1}else for(;!(s=(n=r.call(t)).done)&&(l.push(n.value),l.length!==e);s=!0);}catch(i){c=!0,o=i}finally{try{if(!s&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||D(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],r=n[1],a=n[2];return[o,r,void 0===a?0:a]}))}function F(i,e){if(null===(null==i?void 0:i.geometry))return i;var t=i.geometry,n=void 0===t?{}:t;switch(null==n?void 0:n.type){case"Point":return Z(Z({},i),{},{geometry:{type:"Point",coordinates:k([i.geometry.coordinates].reduce(e,[]))[0]}});case"LineString":return Z(Z({},i),{},{geometry:{type:"LineString",coordinates:k(i.geometry.coordinates.reduce(e,[]))}});case"Polygon":return Z(Z({},i),{},{geometry:{type:"Polygon",coordinates:[k(i.geometry.coordinates[0].reduce(e,[]))]}});default:return i}}const j=function(){return i=function i(){var e,t,n,o,d,u,v,f,m,y=this,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this._map=g.map,this._ready=!1,this._getPositionInfo=g.getPositionInfo?g.getPositionInfo:function(i){var e=i.position||i.endPosition,t=y._map.scene.drillPick(e),n=(0,b.u4)(y._map,i);return{intersected:t,cartesian:n.cartesian,cartographic:n.cartographic}},this._handler=new r.Z(this._map.canvas),this._handler.setInputAction((function(i){y._handleEdit(i,!0)}),a.Z.LEFT_DOUBLE_CLICK),this._handler.setInputAction((function(i){y._handleEdit(i)}),a.Z.LEFT_CLICK),this._handler.setInputAction(p()((function(i){y._handleMouseMove(i)}),null!==(e=g.mouseMoveThrottleTime)&&void 0!==e?e:100),a.Z.MOUSE_MOVE),this._staticPrimitivesCollection=new l.Z({destroyPrimitives:!0}),this._map.scene.primitives.add(this._staticPrimitivesCollection),this._staticBillboardCollection=new s.Z({scene:this._map.scene}),this._map.scene.primitives.add(this._staticBillboardCollection),this._dynamicPrimitivesCollection=new l.Z({destroyPrimitives:!0}),this._map.scene.primitives.add(this._dynamicPrimitivesCollection),this._dynamicBillboardCollection=new s.Z({scene:this._map.scene}),this._map.scene.primitives.add(this._dynamicBillboardCollection),this._style=(0,P.E4)(g.style),this._cursorImage=(0,h.xB)(2*(null===(t=this._style)||void 0===t||null===(n=t.cursor)||void 0===n?void 0:n.radius),{stroke:"#ffffff",strokeWidth:null===(o=this._style)||void 0===o||null===(d=o.cursor)||void 0===d?void 0:d.width,fill:"rgba(0, 0, 0, 0)"}),this._coordinateNodeImage=(0,h.xB)(2*(null===(u=this._style)||void 0===u||null===(v=u.coordinatesNode)||void 0===v?void 0:v.radius),{stroke:"#ffffff",strokeWidth:null===(f=this._style)||void 0===f||null===(m=f.coordinatesNode)||void 0===m?void 0:m.width,fill:"rgba(0, 0, 0, 0.1)"}),this._editing=!1,this._onKeyboardEvent=function(i){var e;"Escape"===i.code&&y._editing&&(y._editing=!1,y._dynamicPrimitivesCollection.removeAll(),y._dynamicBillboardCollection.removeAll()),null!==(e=y._map)&&void 0!==e&&e.scene&&!y._map.isDestroyed()&&y._map.scene.requestRender()},window.addEventListener("keydown",this._onKeyboardEvent),this._featureToModifyProperties=(0,P.cC)({getGeometryType:null==g?void 0:g.getGeometryType}),this._modifyPropertiesToFeatureProperties=P.r2,this._onEditEnd=null!=g&&g.onEditEnd?g.onEditEnd:function(){},this.setGeoJSON((null==g?void 0:g.geojson)||[]),c.Z.initializeTerrainHeights().then((function(){y._ready=!0,y._drawStaticFeatures()}))},(e=[{key:"setGeoJSON",value:function(i){var e=this;this._features=i?("Feature"===(null==i?void 0:i.type)?[i]:null==i?void 0:i.features).map((function(i){return Z(Z({},i),{},{properties:e._featureToModifyProperties(i)})})):[],this._geojson=Z({},i),this._drawStaticFeatures()}},{key:"remove",value:function(){var i;this._handler&&(this._handler.destroy(),this._handler=null),this._editing=!1,this._onKeyboardEvent&&window.removeEventListener("keydown",this._onKeyboardEvent),null!==(i=this._map)&&void 0!==i&&i.isDestroyed&&!this._map.isDestroyed()&&((0,h.U2)(this._map,this._staticPrimitivesCollection),this._staticPrimitivesCollection=null,(0,h.U2)(this._map,this._staticBillboardCollection),this._staticBillboardCollection=null,(0,h.U2)(this._map,this._dynamicPrimitivesCollection),this._dynamicPrimitivesCollection=null,(0,h.U2)(this._map,this._dynamicBillboardCollection),this._dynamicBillboardCollection=null)}},{key:"_drawStaticFeatures",value:function(){var i,e=this;this._ready&&(this._staticBillboardCollection.removeAll(),this._staticPrimitivesCollection.removeAll(),(null===(i=this._features)||void 0===i?void 0:i.length)>0&&this._features.forEach((function(i){e._updatePrimitives(i)})))}},{key:"_updatePrimitives",value:function(i){var e,t,n=this,o=(null==i?void 0:i.properties)||{},r=o.geometryType,a=o.geodesic,l=o.radius,s=N(r,i);if(s)switch(r){case"Circle":var c,d,u,v,f;this._staticBillboardCollection.add({id:null==i?void 0:i.id,position:s[s.length-1],image:this._coordinateNodeImage,color:(0,h.KF)(Z({},null===(e=this._style)||void 0===e?void 0:e.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),a?(this._staticPrimitivesCollection.add((0,h.WX)(Z(Z({},null===(c=this._style)||void 0===c?void 0:c.areaDrawing),{},{coordinates:s[s.length-1],radius:l,clampToGround:!0}))),this._staticPrimitivesCollection.add((0,h.jy)(Z(Z({},null===(d=this._style)||void 0===d?void 0:d.lineDrawing),{},{dashLength:void 0,opacity:.01,coordinates:s[s.length-1],radius:l,allowPicking:!0,id:null==i?void 0:i.id,geodesic:!0}))),this._staticPrimitivesCollection.add((0,h.jy)(Z(Z({},null===(u=this._style)||void 0===u?void 0:u.lineDrawing),{},{coordinates:s[s.length-1],radius:l,allowPicking:!1,geodesic:!0})))):(this._staticPrimitivesCollection.add((0,h.p9)(Z(Z({},null===(v=this._style)||void 0===v?void 0:v.areaDrawing),{},{coordinates:s[s.length-1],radius:l}))),this._staticPrimitivesCollection.add((0,h.uN)(Z(Z({},null===(f=this._style)||void 0===f?void 0:f.lineDrawing),{},{coordinates:s[s.length-1],allowPicking:!0,id:null==i?void 0:i.id,radius:l}))));break;case"Point":this._staticBillboardCollection.add({id:null==i?void 0:i.id,position:s[s.length-1],image:this._coordinateNodeImage,color:(0,h.KF)(Z({},null===(t=this._style)||void 0===t?void 0:t.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY});break;case"LineString":s.length>1&&s.forEach((function(e,t){var o,r,l;s[t+1]&&(n._staticPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(r=n._style)||void 0===r?void 0:r.lineDrawing),{},{dashLength:void 0,opacity:.01,coordinates:[e,s[t+1]],allowPicking:!0,id:"".concat(null==i?void 0:i.id,":").concat(t,":segment"),geodesic:a}))),n._staticPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(l=n._style)||void 0===l?void 0:l.lineDrawing),{},{coordinates:[e,s[t+1]],allowPicking:!1,geodesic:a})))),n._staticBillboardCollection.add({id:"".concat(null==i?void 0:i.id,":").concat(t,":vertex"),position:e,image:n._coordinateNodeImage,color:(0,h.KF)(Z({},null===(o=n._style)||void 0===o?void 0:o.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY})}));break;case"Polygon":var m;s.length>2&&(this._staticPrimitivesCollection.add((0,h.XI)(Z(Z({},null===(m=this._style)||void 0===m?void 0:m.areaDrawing),{},{coordinates:E(s),geodesic:a}))),s.forEach((function(e,t){var o,r,l;s[t+1]&&(n._staticPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(r=n._style)||void 0===r?void 0:r.lineDrawing),{},{dashLength:void 0,opacity:.01,coordinates:[e,s[t+1]],allowPicking:!0,id:"".concat(null==i?void 0:i.id,":").concat(t,":segment"),geodesic:a}))),n._staticPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(l=n._style)||void 0===l?void 0:l.lineDrawing),{},{coordinates:[e,s[t+1]],allowPicking:!1,geodesic:a})))),n._staticBillboardCollection.add({id:"".concat(null==i?void 0:i.id,":").concat(t,":vertex"),position:e,image:n._coordinateNodeImage,color:(0,h.KF)(Z({},null===(o=n._style)||void 0===o?void 0:o.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY})})))}this._map.scene.requestRender()}},{key:"_getPrimitiveFeatureId",value:function(i){return(_()(i)?(i||"").split(":"):[])[0]}},{key:"_getIntersectedInfo",value:function(i){var e=this,t=this._getPositionInfo(i),n=t.cartesian,o=t.cartographic,r=t.intersected.find((function(i){var t=e._getPrimitiveFeatureId(i.id),n=t&&e._features.find((function(i){return(null==i?void 0:i.id)===t}));return!!(n&&i.primitive instanceof d.Z)||!!(n&&i.primitive instanceof u.Z)||!!(n&&i.primitive instanceof v.Z)}))||{},a=r.id;return{cartesian:n,cartographic:o,primitive:r.primitive,id:a}}},{key:"_normalizeGeoJSONResult",value:function(i){var e,t,n=E("Feature"===(null===(e=this._geojson)||void 0===e?void 0:e.type)?[this._geojson]:this._geojson.features).map(i);return"Feature"===(null===(t=this._geojson)||void 0===t?void 0:t.type)?n[0]:{type:"FeatureCollection",features:n}}},{key:"_handleOnEditEnd",value:function(i){var e=this,t=this._normalizeGeoJSONResult((function(t){return t.id===(null==i?void 0:i.id)?Z(Z({},t),{},{geometry:i.geometry,properties:e._modifyPropertiesToFeatureProperties(null==i?void 0:i.properties,t)}):t}));return this._onEditEnd(t)}},{key:"_getSingleLinStringGeometry",value:function(){var i,e,t;return 1===(null===(i=this._features)||void 0===i?void 0:i.length)&&"LineString"===(null===(e=this._features[0])||void 0===e||null===(t=e.geometry)||void 0===t?void 0:t.type)&&this._features[0]}},{key:"_handleMouseMove",value:function(i){var e=this;this._dynamicPrimitivesCollection.removeAll(),this._dynamicBillboardCollection.removeAll();var t,n,r=this._getIntersectedInfo(i),a=r.primitive,l=r.cartesian,s=this._getPrimitiveFeatureId(this._editing?this._editing.id:r.id),c=s&&this._features.find((function(i){return i.id===s})),y=(null==c?void 0:c.properties)||{},p=y.geometryType,g=y.radius,_=y.geodesic;if(this._editing){var b,P,w;if(["Point","Circle"].includes(p)&&this._editing.primitive instanceof d.Z&&(this._dynamicBillboardCollection.add({position:l,image:this._coordinateNodeImage,color:(0,h.KF)(Z({},null===(b=this._style)||void 0===b?void 0:b.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),"Circle"===p&&this._dynamicPrimitivesCollection.add(_?(0,h.WX)(Z(Z({},null===(P=this._style)||void 0===P?void 0:P.area),{},{coordinates:l,radius:g,clampToGround:!0})):(0,h.p9)(Z(Z({},null===(w=this._style)||void 0===w?void 0:w.areaDrawing),{},{coordinates:l,radius:g}))),_)){var I,C,O=(0,m.Rk)([l]);this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(I=this._style)||void 0===I?void 0:I.wireframe),{},{coordinates:[O[0],l]}))),this._dynamicBillboardCollection.add({position:O[0],image:this._coordinateNodeImage,color:(0,h.KF)(Z({},null===(C=this._style)||void 0===C?void 0:C.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY})}if("Circle"===p&&(this._editing.primitive instanceof v.Z||this._editing.primitive instanceof u.Z)){var T,D=o.Z.toCartesian(new o.Z(f.Z.toRadians(c.geometry.coordinates[0]),f.Z.toRadians(c.geometry.coordinates[1]),null!==(T=c.geometry.coordinates[2])&&void 0!==T?T:0)),S=(0,m.Qk)([D,l],_);if(_){var k,F,j,A,B,R,L,K=(0,m.Rk)([D,l],(function(i){var e;return null===(e=i[i.length-1])||void 0===e?void 0:e.height})),G=(0,m.Rk)([D,l]);this._dynamicPrimitivesCollection.add((0,h.WX)(Z(Z({},null===(k=this._style)||void 0===k?void 0:k.area),{},{coordinates:D,radius:S,clampToGround:!0}))),this._dynamicPrimitivesCollection.add((0,h.jy)(Z(Z({},null===(F=this._style)||void 0===F?void 0:F.wireframe),{},{coordinates:K[0],radius:S,geodesic:!0}))),this._dynamicPrimitivesCollection.add((0,h.jy)(Z(Z({},null===(j=this._style)||void 0===j?void 0:j.lineDrawing),{},{coordinates:G[0],radius:S,geodesic:!0}))),this._dynamicBillboardCollection.add({position:D,image:this._cursorImage,color:(0,h.KF)(Z({},null===(A=this._style)||void 0===A?void 0:A.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),this._dynamicBillboardCollection.add({position:K[0],image:this._cursorImage,color:(0,h.KF)(Z({},null===(B=this._style)||void 0===B?void 0:B.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),this._dynamicBillboardCollection.add({position:G[0],image:this._cursorImage,color:(0,h.KF)(Z({},null===(R=this._style)||void 0===R?void 0:R.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(L=this._style)||void 0===L?void 0:L.wireframe),{},{geodesic:!0,coordinates:[D,G[0],G[1],K[1],K[0]]})))}else{var M,V;this._dynamicPrimitivesCollection.add((0,h.uN)(Z(Z({},null===(M=this._style)||void 0===M?void 0:M.lineDrawing),{},{coordinates:D,radius:S}))),this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(V=this._style)||void 0===V?void 0:V.wireframe),{},{coordinates:[D,l]})))}}if(["LineString","Polygon"].includes(p)&&this._editing.primitive instanceof d.Z){var Y,z=parseFloat(this._editing.id.split(":")[1]),x=N(p,c),U=[].concat(E(x[z-1]?[x[z-1]]:"Polygon"===p?[x[x.length-2]]:[]),[l],E(x[z+1]?[x[z+1]]:"Polygon"===p?[x[1]]:[]));if(this._dynamicBillboardCollection.add({position:l,image:this._coordinateNodeImage,color:(0,h.KF)(Z({},null===(Y=this._style)||void 0===Y?void 0:Y.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),_){var X,q,J=o.Z.fromCartesian(l).height,W=(0,m.Rk)(U,(function(){return J})),Q=(0,m.Rk)(U);this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(X=this._style)||void 0===X?void 0:X.wireframe),{},{geodesic:_,coordinates:E(W)}))),this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(q=this._style)||void 0===q?void 0:q.lineDrawing),{},{geodesic:_,coordinates:E(Q)}))),W.forEach((function(i,t){var n;e._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(n=e._style)||void 0===n?void 0:n.wireframe),{},{geodesic:_,coordinates:[Q[t],W[t]]})))}))}else{var H;this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(H=this._style)||void 0===H?void 0:H.lineDrawing),{},{coordinates:U})))}}if(["LineString","Polygon"].includes(p)&&this._editing.primitive instanceof u.Z){var $,ii=parseFloat(this._editing.id.split(":")[1]),ei=N(p,c),ti=[].concat(E(ei[ii]?[ei[ii]]:[]),[l],E(ei[ii+1]?[ei[ii+1]]:[]));if(this._dynamicBillboardCollection.add({position:l,image:this._coordinateNodeImage,color:(0,h.KF)(Z({},null===($=this._style)||void 0===$?void 0:$.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),_){var ni,oi,ri=o.Z.fromCartesian(l).height,ai=(0,m.Rk)(ti,(function(){return ri})),li=(0,m.Rk)(ti);this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(ni=this._style)||void 0===ni?void 0:ni.wireframe),{},{geodesic:_,coordinates:E(ai)}))),this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(oi=this._style)||void 0===oi?void 0:oi.lineDrawing),{},{geodesic:_,coordinates:E(li)}))),ai.forEach((function(i,t){var n;e._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(n=e._style)||void 0===n?void 0:n.wireframe),{},{geodesic:_,coordinates:[li[t],ai[t]]})))}))}else{var si;this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(si=this._style)||void 0===si?void 0:si.lineDrawing),{},{coordinates:[].concat(E(ei[ii]?[ei[ii]]:[]),[l],E(ei[ii+1]?[ei[ii+1]]:[]))})))}}var ci=this._getSingleLinStringGeometry();if(!this._editing.primitive&&ci&&l){var di,ui,vi=N(p,ci);if(null==ci||null===(di=ci.properties)||void 0===di?void 0:di.geodesic){var fi,hi,mi=[vi[vi.length-1],l],yi=(0,m.Rk)(mi,(function(i){var e;return null===(e=i[i.length-1])||void 0===e?void 0:e.height})),pi=(0,m.Rk)(mi);this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(fi=this._style)||void 0===fi?void 0:fi.wireframe),{},{geodesic:!0,coordinates:E(yi)}))),this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(hi=this._style)||void 0===hi?void 0:hi.lineDrawing),{},{geodesic:!0,coordinates:E(pi)}))),yi.forEach((function(i,t){var n;e._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(n=e._style)||void 0===n?void 0:n.wireframe),{},{geodesic:!0,coordinates:[pi[t],yi[t]]})))}))}else{var gi;this._dynamicPrimitivesCollection.add((0,h.c4)(Z(Z({},null===(gi=this._style)||void 0===gi?void 0:gi.lineDrawing),{},{coordinates:[vi[vi.length-1],l]})))}this._dynamicBillboardCollection.add({position:l,image:this._coordinateNodeImage,color:(0,h.KF)(Z({},null===(ui=this._style)||void 0===ui?void 0:ui.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY})}return this._map.scene.requestRender(),null}return a instanceof d.Z&&this._dynamicBillboardCollection.add({position:a.position,image:this._cursorImage,color:(0,h.KF)(Z({},null===(t=this._style)||void 0===t?void 0:t.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),(a instanceof u.Z||a instanceof v.Z)&&this._dynamicBillboardCollection.add({position:l,image:this._cursorImage,color:(0,h.KF)(Z({},null===(n=this._style)||void 0===n?void 0:n.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),this._map.scene.requestRender(),null}},{key:"_handleEdit",value:function(i,e){var t=this._getIntersectedInfo(i),n=this._getPrimitiveFeatureId(this._editing?this._editing.id:t.id),r=n&&this._features.find((function(i){return i.id===n})),a=(null==r?void 0:r.properties)||{},l=a.geometryType,s=a.geodesic;if(this._editing){this._dynamicPrimitivesCollection.removeAll(),this._dynamicBillboardCollection.removeAll();var c=this._editing.primitive,h=this._editing.id;this._editing=!1;var y=t.cartographic,p=t.cartesian,g=y&&[f.Z.toDegrees(y.longitude),f.Z.toDegrees(y.latitude),s?0:y.height];if(["Circle","Point"].includes(l)&&g&&c instanceof d.Z)return this._handleOnEditEnd(F(r,(function(i){return[].concat(E(i),[g])})));if("Circle"===l&&g&&(c instanceof v.Z||c instanceof u.Z)){var _,b=o.Z.toCartesian(new o.Z(f.Z.toRadians(r.geometry.coordinates[0]),f.Z.toRadians(r.geometry.coordinates[1]),null!==(_=r.geometry.coordinates[2])&&void 0!==_?_:0)),P=(0,m.Qk)([b,p],s);return this._handleOnEditEnd(Z(Z({},r),{},{properties:Z(Z({},null==r?void 0:r.properties),{},{radius:P})}))}if("Polygon"===l&&g&&c instanceof d.Z){var w=parseFloat(h.split(":")[1]),I=function(i){return 0===w||w===i.length-1?[0,i.length-1]:[w]};return this._handleOnEditEnd(F(r,(function(i,e,t,n){return[].concat(E(i),[I(n).includes(t)?g:e])})))}if(g&&c instanceof d.Z){var C=parseFloat(h.split(":")[1]);return this._handleOnEditEnd(F(r,(function(i,e,t){return[].concat(E(i),[t===C?g:e])})))}if(g&&c instanceof u.Z){var O=parseFloat(h.split(":")[1]);return this._handleOnEditEnd(F(r,(function(i,e,t){return[].concat(E(i),[e],E(t===O?[g]:[]))})))}var T=this._getSingleLinStringGeometry();if(g&&!c&&T){var D,S=[g[0],g[1],null!=T&&null!==(D=T.properties)&&void 0!==D&&D.geodesic?0:g[2]];return e?this._handleOnEditEnd(F(T,(function(i,e,t,n){return[].concat(E(i),E(t<n.length-1?[e]:[]))}))):(this._editing={id:h},this._handleOnEditEnd(F(T,(function(i,e,t,n){return[].concat(E(i),[e],E(t===n.length-1?[S]:[]))}))))}}else this._editing=t,t.primitive||this._getSingleLinStringGeometry()||(this._editing=!1);return null}}])&&I(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,e}(),A=function(i){var e=i.map,t=i.active,o=i.geojson,r=i.onEditEnd,a=i.getGeometryType,l=i.style,s=i.getPositionInfo,c=(0,n.useRef)();return(0,n.useEffect)((function(){return null!=e&&e.canvas&&t&&(c.current=new j({map:e,geojson:o,getGeometryType:a,onEditEnd:r,style:l,getPositionInfo:s})),function(){c.current&&(c.current.remove(),c.current=null)}}),[e,t]),(0,n.useEffect)((function(){c.current&&c.current.setGeoJSON(o)}),[o]),null}},854788:(i,e,t)=>{"use strict";function n(i){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},n(i)}function o(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.push.apply(t,n)}return t}function r(i){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach((function(e){a(i,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(t,e))}))}return i}function a(i,e,t){return(e=function(i){var e=function(i){if("object"!=n(i)||!i)return i;var e=i[Symbol.toPrimitive];if(void 0!==e){var t=e.call(i,"string");if("object"!=n(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(i);return"symbol"==n(e)?e:e+""}(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function l(i){return r({wireframe:{color:"#000000",opacity:1,depthFailColor:"#000000",depthFailOpacity:.4,width:.5},lineDrawing:{color:"#000000",opacity:1,depthFailColor:"#000000",depthFailOpacity:.4,width:3,dashLength:8},line:{color:"#ffcc33",opacity:1,depthFailColor:"#ffcc33",depthFailOpacity:.4,width:2},areaDrawing:{color:"#ffffff",opacity:.5,depthFailColor:"#ffffff",depthFailOpacity:.25},area:{color:"#ffffff",opacity:.5,depthFailColor:"#ffffff",depthFailOpacity:.25},cursor:{color:"#ff0000",width:2,radius:4},coordinatesNode:{color:"#333333",width:2,radius:5}},i)}t.d(e,{E4:()=>l,cC:()=>c,r2:()=>d});var s=function(i){var e;return null==i||null===(e=i.geometry)||void 0===e?void 0:e.type},c=function(){var i=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).getGeometryType,e=void 0===i?s:i;return function(i){return r(r({},null==i?void 0:i.properties),{},{geometryType:e(i)})}},d=function(i,e){return r(r({},null==e?void 0:e.properties),void 0!==(null==i?void 0:i.radius)&&{radius:i.radius})}},433353:(i,e,t)=>{"use strict";t.d(e,{u4:()=>l,ZP:()=>s});var n=t(532056),o=t(11020),r=t(604274),a=t(958913);function l(i,e){var t=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).pickObjectsLimit,o=void 0===t?Number.MAX_VALUE:t,l=i.scene,s=i.camera,c=e.position||e.endPosition,d=l.pick(c),u=l.pickPosition(c);if(!((null==d?void 0:d.primitive)instanceof r.Z)&&!((null==d?void 0:d.primitive)instanceof a.Z)&&d&&u)return{cartesian:u,cartographic:n.Z.fromCartesian(u),feature:d};var v,f=s.getPickRay(c),h=l.drillPickFromRay(f,o).find((function(i){var e=i.exclude,t=i.object,n=i.position;return!e&&n&&t}))||null;if(h)return{cartesian:h.position,cartographic:n.Z.fromCartesian(h.position),feature:null==h||null===(v=h.object)||void 0===v?void 0:v.primitive};var m=l.globe.pick(f,l);return m?{cartesian:m,cartographic:n.Z.fromCartesian(m)}:{}}const s={getMouseXYZ:function(i,e){var t=i.scene,r=e.position||e.endPosition;if(!r)return null;if(i.scene.drillPick(r).find((function(i){var e,t,n;return!(!1===(null==i||null===(e=i.id)||void 0===e||null===(t=e.entityCollection)||void 0===t||null===(n=t.owner)||void 0===n?void 0:n.queryable))}))){var a=t.globe.depthTestAgainstTerrain,l=t.pickTranslucentDepth;t.globe.depthTestAgainstTerrain=!0,t.pickTranslucentDepth=!0;var s=t.pickPosition(r);if(t.globe.depthTestAgainstTerrain=a,t.pickTranslucentDepth=l,s)return n.Z.fromCartesian(s)}var c=i.camera.getPickRay(r),d=i.scene.globe.pick(c,i.scene),u=t._globe.ellipsoid;if(o.Z(d)){var v=u.cartesianToCartographic(d),f=function(i,e){if(null!==e.position){var t=i.scene,n=t._globe.ellipsoid;return t.camera.pickEllipsoid(e.position||e.endPosition,n)}return null}(i,e);return f&&(v.height=t._globe.getHeight(v),v.cartesian=f,v.position=d),v}return null},getMouseTile:function(i,e){var t=i.scene;if(!e.position)return null;var n=i.camera.getPickRay(e.position);return i.scene.globe.pickTile(n,t)}}},637453:(i,e,t)=>{"use strict";t.d(e,{eN:()=>f,tj:()=>h,Ys:()=>m,bj:()=>y,Qg:()=>p,nz:()=>g,Qk:()=>b,vZ:()=>P,g7:()=>w,Rk:()=>I});var n=t(660904),o=t(344485),r=t(405254),a=t(532056),l=t(835189),s=t(509187),c=t.n(s);function d(i,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},d(i,e)}function u(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(i){}return(u=function(){return!!i})()}function v(i,e){(null==e||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function f(i,e){var t=n.Z.subtract(e,i,new n.Z),o=n.Z.multiplyByScalar(t,.5,new n.Z);return n.Z.add(i,o,new n.Z)}function h(i,e){var t=n.Z.normalize(i,new n.Z),r=n.Z.normalize(e,new n.Z),a=n.Z.dot(t,r);return o.Z.toDegrees(Math.acos(a))}function m(i){return i.map((function(e,t){var o=i[t-1],r=i[t+1];return o&&r?h(n.Z.subtract(o,e,new n.Z),n.Z.subtract(r,e,new n.Z)):null})).filter((function(i){return null!==i}))}function y(i){return new n.Z((i[0].x+i[1].x+i[2].x)/3,(i[0].y+i[1].y+i[2].y)/3,(i[0].z+i[1].z+i[2].z)/3)}function p(i,e){return i.map((function(t,o){var r=i[o-1],a=i[o+1];if(r&&a){var l=function(i,e){var t=n.Z.normalize(i,new n.Z),o=n.Z.normalize(e,new n.Z);return n.Z.cross(t,o,new n.Z)}(n.Z.subtract(r,t,new n.Z),n.Z.subtract(a,t,new n.Z)),s=-Math.sign(n.Z.dot(l,n.Z.subtract(t,e,new n.Z),new n.Z));return h(n.Z.multiplyByScalar(l,s,new n.Z),t)}return null})).filter((function(i){return null!==i}))}function g(i,e){if((null==i?void 0:i.length)<3)return 0;for(var t=r.Z.packArray(i),o=c()(t,e,2),a=0,l=0;l<o.length;l+=3){var s=i[o[l]],d=i[o[l+1]],u=i[o[l+2]],v=n.Z.subtract(d,s,new n.Z),f=n.Z.subtract(u,s,new n.Z),h=n.Z.cross(v,f,new n.Z);a+=n.Z.magnitude(h)/2}return a}function _(i,e){var t,n=[i,e].map((function(i){return a.Z.fromCartesian(i)}));return function(i,e,t){if(u())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(i.bind.apply(i,n));return t&&d(o,t.prototype),o}(l.Z,(t=n.map((function(i){var e=i.longitude,t=i.latitude;return new a.Z(e,t,0)})),function(i){if(Array.isArray(i))return v(i)}(t)||function(i){if("undefined"!=typeof Symbol&&null!=i[Symbol.iterator]||null!=i["@@iterator"])return Array.from(i)}(t)||function(i,e){if(i){if("string"==typeof i)return v(i,e);var t={}.toString.call(i).slice(8,-1);return"Object"===t&&i.constructor&&(t=i.constructor.name),"Map"===t||"Set"===t?Array.from(i):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?v(i,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).surfaceDistance}function b(i,e){return(null==i?void 0:i.length)<2?0:i.reduce((function(t,o,r){return i[r-1]?t+(e?_(o,i[r-1]):n.Z.distance(o,i[r-1])):t}),0)}function P(i){return Math.sign(a.Z.fromCartesian(i[1]).height-a.Z.fromCartesian(i[0]).height)}function w(i,e){var t=a.Z.fromCartesian(i),n=t.longitude,r=t.latitude,l=t.height;return[o.Z.toDegrees(n),o.Z.toDegrees(r),null!=e?e:l]}function I(i,e){var t=i.map((function(i){return a.Z.fromCartesian(i)})),n=e?e(t):0;return t.map((function(i){var e=i.longitude,t=i.latitude;return a.Z.toCartesian(new a.Z(e,t,n))}))}}}]);