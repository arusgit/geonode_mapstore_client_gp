(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[12290],{212290:function(e,r,t){"use strict";var o=this&&this.__spreadArray||function(e,r,t){if(t||2===arguments.length)for(var o,a=0,i=r.length;a<i;a++)!o&&a in r||(o||(o=Array.prototype.slice.call(r,0,a)),o[a]=r[a]);return e.concat(o||Array.prototype.slice.call(r))};Object.defineProperty(r,"__esModule",{value:!0}),r.SldStyleParser=void 0;var a=t(266023),i=t(747037),n=t(281763),l=t(227361),s=t(436968),c=t(441609),m=function(){function e(e){this.title="SLD Style Parser",this._numericFilterFields=[],this._boolFilterFields=[],this._forceCasting=!1,this._prettyOutput=!0,this.getTextSymbolizerLabelFromSldSymbolizer=function(e){var r="",t=l(e,"Literal"),o=l(e,"PropertyName"),a="Literal"===Object.keys(e)[0];if(o&&o.length>0){var i=o.map((function(e){return"{{".concat(e,"}}")}));t&&t.length>0?a?(t.forEach((function(e,t){r+="".concat(e),i[t]&&(r+="".concat(i[t]))})),i.length>t.length&&(r+=i.join(""))):(i.forEach((function(e,o){r+="".concat(e),t[o]&&(r+="".concat(t[o]))})),t.length>i.length&&(r+=t.join(""))):r=i.join("")}else t&&t.length>0?r=t.join(""):"string"==typeof e&&(r=e);return r},this.getSldLabelFromTextSymbolizer=function(e){var r=new RegExp("\\{\\{.*?\\}\\}","g"),t=e.match(r),o=e.startsWith("{{");if(t){var a=e.split(r),i=[];a.forEach((function(e){0!==e.length&&i.push(e)}));var n=t.map((function(e){return e.slice(2,e.length-2)}));return o?[{"ogc:PropertyName":n,"ogc:Literal":i}]:[{"ogc:Literal":i,"ogc:PropertyName":n}]}return[{"ogc:Literal":[e]}]},Object.assign(this,e)}return Object.defineProperty(e.prototype,"numericFilterFields",{get:function(){return this._numericFilterFields},set:function(e){this._numericFilterFields=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boolFilterFields",{get:function(){return this._boolFilterFields},set:function(e){this._boolFilterFields=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forceCasting",{get:function(){return this._forceCasting},set:function(e){this._forceCasting=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"prettyOutput",{get:function(){return this._prettyOutput},set:function(e){this._prettyOutput=e},enumerable:!1,configurable:!0}),e.keysByValue=function(e,r){return Object.keys(e).filter((function(t){return e[t]===r}))},e.prototype.tagNameProcessor=function(e){var r=new RegExp(/(?!xmlns)^.*:/);return e.replace(r,"")},e.prototype.getStyleNameFromSldObject=function(e){var r=l(e,"StyledLayerDescriptor.NamedLayer[0].UserStyle[0].Title[0]"),t=l(e,"StyledLayerDescriptor.NamedLayer[0].Name[0]");return r||t||""},e.prototype.getStrMatchesFunctionFilterFromSldFilter=function(e){var r=l(e,"Function[0].PropertyName[0]"),t=l(e,"Function[0].Literal[0]");return["FN_strMatches",r,new RegExp(t)]},e.prototype.getFunctionFilterFromSldFilter=function(e){return l(e,"Function[0].$.name"),this.getStrMatchesFunctionFilterFromSldFilter(e)},e.prototype.getFilterFromOperatorAndComparison=function(r,t){var a,n=this;if(Object.keys(e.comparisonMap).includes(r)){var l=e.comparisonMap[r],s=!!t.Function,c=s?this.getFunctionFilterFromSldFilter(t):t.PropertyName[0],m=null;if("PropertyIsNull"!==r&&(m=t.Literal[0]),(this.forceCasting||s||-1!==this.numericFilterFields.indexOf(c))&&!Number.isNaN(parseFloat(m))&&(m=parseFloat(m)),i(m)){var p=m.toLowerCase();(this.forceCasting||s||-1!==this.boolFilterFields.indexOf(c))&&("false"===p&&(m=!1),"true"===p&&(m=!0))}a=[l,c,m]}else if(Object.keys(e.combinationMap).includes(r)){var h=e.combinationMap[r],y=[];Object.keys(t).forEach((function(e){1===t[e].length?y.push(n.getFilterFromOperatorAndComparison(e,t[e][0])):t[e].forEach((function(r){y.push(n.getFilterFromOperatorAndComparison(e,r))}))})),a=o([h],y,!0)}else{if(!Object.keys(e.negationOperatorMap).includes(r))throw new Error("No Filter detected");var u=e.negationOperatorMap[r],S=Object.keys(t)[0],f=t[S][0];a=[u,this.getFilterFromOperatorAndComparison(S,f)]}return a},e.prototype.getFilterFromRule=function(e){var r=e.Filter;if(r){var t=r[0],o=Object.keys(t).find((function(e,r){return"$"!==e}));if(o){var a=t[o][0];return this.getFilterFromOperatorAndComparison(o,a)}}},e.prototype.getScaleDenominatorFromRule=function(e){var r={};return e.MinScaleDenominator&&(r.min=parseFloat(e.MinScaleDenominator[0])),e.MaxScaleDenominator&&(r.max=parseFloat(e.MaxScaleDenominator[0])),r.min||r.max?r:void 0},e.prototype.getMarkSymbolizerFromSldSymbolizer=function(e){var r=l(e,"Graphic[0].Mark[0].WellKnownName[0]"),t=l(e,"Graphic[0].Mark[0].Stroke[0].CssParameter")||[];0===t.length&&(t=l(e,"Graphic[0].Mark[0].Stroke[0].SvgParameter")||[]);var o=l(e,"Graphic[0].Opacity[0]"),a=l(e,"Graphic[0].Size[0]"),i=l(e,"Graphic[0].Rotation[0]"),n=l(e,"Graphic[0].Mark[0].Fill[0].CssParameter")||[];0===n.length&&(n=l(e,"Graphic[0].Mark[0].Fill[0].SvgParameter")||[]);var s=n.findIndex((function(e){return"fill"===e.$.name})),c=l(e,"Graphic[0].Mark[0].Fill[0].CssParameter["+s+"]._");if(!c){var m=l(e,"Graphic[0].Mark[0].Fill[0].SvgParameter["+s+"]._");m&&(c=m)}var p=n.findIndex((function(e){return"fill-opacity"===e.$.name})),h=l(e,"Graphic[0].Mark[0].Fill[0].CssParameter["+p+"]._"),y={kind:"Mark"};switch(o&&(y.opacity=parseFloat(o)),h&&(y.fillOpacity=parseFloat(h)),c&&(y.color=c),i&&(y.rotate=parseFloat(i)),a&&(y.radius=parseFloat(a)/2),r){case"circle":case"square":case"triangle":case"star":case"cross":case"x":var u=r.charAt(0).toUpperCase()+r.slice(1);y.wellKnownName=u;break;case"shape://vertline":case"shape://horline":case"shape://slash":case"shape://backslash":case"shape://dot":case"shape://plus":case"shape://times":case"shape://oarrow":case"shape://carrow":y.wellKnownName=r;break;default:throw new Error("MarkSymbolizer cannot be parsed. Unsupported WellKnownName.")}return t.forEach((function(e){switch(e.$.name){case"stroke":y.strokeColor=e._;break;case"stroke-width":y.strokeWidth=parseFloat(e._);break;case"stroke-opacity":y.strokeOpacity=parseFloat(e._)}})),y},e.prototype.getIconSymbolizerFromSldSymbolizer=function(e){var r={kind:"Icon",image:l(e,"Graphic[0].ExternalGraphic[0].OnlineResource[0]").$["xlink:href"]},t=l(e,"Graphic[0].Opacity[0]"),o=l(e,"Graphic[0].Size[0]"),a=l(e,"Graphic[0].Rotation[0]");return void 0!==t&&(r.opacity=t),o&&(r.size=parseFloat(o)),a&&(r.rotate=parseFloat(a)),r},e.prototype.getPointSymbolizerFromSldSymbolizer=function(e){var r={},t=l(e,"Graphic[0].Mark[0].WellKnownName[0]");return l(e,"Graphic[0].ExternalGraphic[0]")?r=this.getIconSymbolizerFromSldSymbolizer(e):(t||s(e,"Graphic[0].Mark[0].WellKnownName[0]","square"),r=this.getMarkSymbolizerFromSldSymbolizer(e)),r},e.prototype.getLineSymbolizerFromSldSymbolizer=function(e){var r=this,t={kind:"Line"},o=Object.keys(l(e,"Stroke[0]"))||[];if(o.length<1)throw new Error("LineSymbolizer cannot be parsed. No Stroke detected");o.forEach((function(o){switch(o){case"CssParameter":case"SvgParameter":var a=l(e,"Stroke[0].CssParameter")||[];if(0===a.length&&(a=l(e,"Stroke[0].SvgParameter")||[]),a.length<1)throw new Error("LineSymbolizer can not be parsed. No CssParameters detected.");a.forEach((function(e){var r=e.$.name,o=e._;switch(r){case"stroke":t.color=o;break;case"stroke-width":t.width=parseFloat(o);break;case"stroke-opacity":t.opacity=parseFloat(o);break;case"stroke-linejoin":t.join="mitre"===o?"miter":o;break;case"stroke-linecap":t.cap=o;break;case"stroke-dasharray":var a=o.split(" ").map((function(e){return parseFloat(e)}));t.dasharray=a;break;case"stroke-dashoffset":t.dashOffset=parseFloat(o)}}));break;case"GraphicStroke":t.graphicStroke=r.getPointSymbolizerFromSldSymbolizer(e.Stroke[0].GraphicStroke[0]);break;case"GraphicFill":t.graphicFill=r.getPointSymbolizerFromSldSymbolizer(e.Stroke[0].GraphicFill[0])}}));var a=l(e,"PerpendicularOffset[0]");return void 0!==a&&(t.perpendicularOffset=Number(a)),t},e.prototype.getFillSymbolizerFromSldSymbolizer=function(e){var r={kind:"Fill"},t=l(e,"Fill[0].CssParameter")||[];0===t.length&&(t=l(e,"Fill[0].SvgParameter")||[]);var o=l(e,"Stroke[0].CssParameter")||[];0===o.length&&(o=l(e,"Stroke[0].SvgParameter")||[]);var a=l(e,"Fill[0].GraphicFill[0]");return a&&(r.graphicFill=this.getPointSymbolizerFromSldSymbolizer(a)),t.forEach((function(e){var t=e.$.name,o=e._;switch(t){case"fill":r.color=o;break;case"fill-opacity":r.fillOpacity=parseFloat(o)}})),r.color||(r.opacity=0),o.forEach((function(e){var t=e.$.name,o=e._;if("stroke"===t)r.outlineColor=o;else if("stroke-width"===t)r.outlineWidth=parseFloat(o);else if("stroke-opacity"===t)r.outlineOpacity=parseFloat(o);else if("stroke-dasharray"===t){var a=o.split(" "),i=[];a.forEach((function(e){i.push(parseFloat(e))})),r.outlineDasharray=i}})),r},e.prototype.getColorMapFromSldColorMap=function(e){var r={},t=l(e,"$.type");r.type=t||"ramp";var o=l(e,"$.extended");o&&(r.extended="true"===o);var a=l(e,"ColorMapEntry");if(Array.isArray(a)){var i=a.map((function(e){var r=l(e,"$.color");if(!r)throw new Error("Cannot parse ColorMapEntries. color is undefined.");var t=l(e,"$.quantity");t&&(t=parseFloat(t));var o=l(e,"$.label"),a=l(e,"$.opacity");return a&&(a=parseFloat(a)),{color:r,quantity:t,label:o,opacity:a}}));r.colorMapEntries=i}return r},e.prototype.getContrastEnhancementFromSldContrastEnhancement=function(e){var r={},t=void 0!==e.Histogram,o=void 0!==e.Normalize;if(t&&o)throw new Error("Cannot parse ContrastEnhancement. Histogram and Normalize\n      are mutually exclusive.");t?r.enhancementType="histogram":o&&(r.enhancementType="normalize");var a=l(e,"GammaValue[0]");return a&&(a=parseFloat(a)),r.gammaValue=a,r},e.prototype.getChannelFromSldChannel=function(e){var r={sourceChannelName:l(e,"SourceChannelName[0]")},t=l(e,"ContrastEnhancement[0]");return t&&(r.contrastEnhancement=this.getContrastEnhancementFromSldContrastEnhancement(t)),r},e.prototype.getChannelSelectionFromSldChannelSelection=function(e){var r,t=l(e,"RedChannel[0]"),o=l(e,"BlueChannel[0]"),a=l(e,"GreenChannel[0]"),i=l(e,"GrayChannel[0]");if(i&&t&&o&&a)throw new Error("Cannot parse ChannelSelection. RGB and Grayscale are mutually exclusive");if(i)r={grayChannel:this.getChannelFromSldChannel(i)};else{if(!(t&&a&&o))throw new Error("Cannot parse ChannelSelection. Red, Green and Blue channels must be defined.");r={redChannel:this.getChannelFromSldChannel(t),blueChannel:this.getChannelFromSldChannel(o),greenChannel:this.getChannelFromSldChannel(a)}}return r},e.prototype.getRasterSymbolizerFromSldSymbolizer=function(e){var r={kind:"Raster"},t=l(e,"Opacity[0]");t&&(t=parseFloat(t),r.opacity=t);var o=l(e,"ColorMap")||[];if(o.length>0){var a=this.getColorMapFromSldColorMap(o[0]);r.colorMap=a}var i=l(e,"ChannelSelection")||[];if(i.length>0){var n=this.getChannelSelectionFromSldChannelSelection(i[0]);r.channelSelection=n}var s=l(e,"ContrastEnhancement")||[];if(s.length>0){var c=this.getContrastEnhancementFromSldContrastEnhancement(s[0]);r.contrastEnhancement=c}return r},e.prototype.getTextSymbolizerFromSldSymbolizer=function(e){var r={kind:"Text"},t=l(e,"Font[0].CssParameter")||[];0===t.length&&(t=l(e,"Font[0].SvgParameter")||[]);var o=l(e,"Label[0]");o&&(r.label=this.getTextSymbolizerLabelFromSldSymbolizer(o));var a=l(e,"Fill[0].CssParameter[0]._");a||(a=l(e,"Fill[0].SvgParameter[0]._"));var i=l(e,"Halo[0].Fill[0].CssParameter")||[];0===i.length&&(i=l(e,"Halo[0].Fill[0].SvgParameter")||[]);var n=l(e,"Halo[0].Radius[0]");a&&(r.color=a),n&&(r.haloWidth=parseFloat(n)),i.forEach((function(e){var t=e.$.name,o=e._;"fill"===t&&(r.haloColor=o)}));var s=l(e,"LabelPlacement[0].PointPlacement[0].Displacement[0]");if(s){var c=s.DisplacementX[0],m=s.DisplacementY[0];r.offset=[c?parseFloat(c):0,m?parseFloat(m):0]}var p=l(e,"LabelPlacement[0].PointPlacement[0].Rotation[0]");return p&&(r.rotate=parseFloat(p)),t.forEach((function(e){var t=e.$.name,o=e._;switch(t){case"font-family":r.font=[o];break;case"font-style":r.fontStyle=o;break;case"font-weight":r.fontWeight=o;break;case"font-size":r.size=parseFloat(o)}})),r},e.prototype.getSymbolizersFromRule=function(e){var r=this,t=[];return Object.keys(e).filter((function(e){return e.endsWith("Symbolizer")})).forEach((function(o){e[o].forEach((function(e){var a;switch(o){case"PointSymbolizer":a=r.getPointSymbolizerFromSldSymbolizer(e);break;case"LineSymbolizer":a=r.getLineSymbolizerFromSldSymbolizer(e);break;case"TextSymbolizer":a=r.getTextSymbolizerFromSldSymbolizer(e);break;case"PolygonSymbolizer":a=r.getFillSymbolizerFromSldSymbolizer(e);break;case"RasterSymbolizer":a=r.getRasterSymbolizerFromSldSymbolizer(e);break;default:throw new Error("Failed to parse SymbolizerKind from SldRule")}t.push(a)}))})),t},e.prototype.getRulesFromSldObject=function(e){var r=this,t=e.StyledLayerDescriptor.NamedLayer,o=[];return t.forEach((function(e){e.UserStyle.forEach((function(e){e.FeatureTypeStyle.forEach((function(e){e.Rule.forEach((function(e){var t=r.getFilterFromRule(e),a=r.getScaleDenominatorFromRule(e),i=r.getSymbolizersFromRule(e),n={name:e.Title?e.Title[0]:e.Name?e.Name[0]:""};t&&(n.filter=t),a&&(n.scaleDenominator=a),i&&(n.symbolizers=i),o.push(n)}))}))}))})),o},e.prototype.sldObjectToGeoStylerStyle=function(e){var r=this.getRulesFromSldObject(e);return{name:this.getStyleNameFromSldObject(e),rules:r}},e.prototype.readStyle=function(e){var r=this;return new Promise((function(t,o){var i={tagNameProcessors:[r.tagNameProcessor]};try{(0,a.parseString)(e,i,(function(e,a){e&&o("Error while parsing sldString: ".concat(e));var i=r.sldObjectToGeoStylerStyle(a);t(i)}))}catch(e){o(e)}}))},e.prototype.writeStyle=function(e){var r=this;return new Promise((function(t,o){try{var i={renderOpts:{pretty:r.prettyOutput}},n=new a.Builder(i),l=r.geoStylerStyleToSldObject(e);t(n.buildObject(l))}catch(e){o(e)}}))},e.prototype.geoStylerStyleToSldObject=function(e){var r=this.getSldRulesFromRules(e.rules);return r.forEach((function(e){e.Filter&&!e.Filter.$&&(e.Filter.$={xmlns:"http://www.opengis.net/ogc"})})),{StyledLayerDescriptor:{$:{version:"1.0.0","xsi:schemaLocation":"http://www.opengis.net/sld StyledLayerDescriptor.xsd",xmlns:"http://www.opengis.net/sld","xmlns:ogc":"http://www.opengis.net/ogc","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance"},NamedLayer:[{Name:[e.name||""],UserStyle:[{Name:[e.name||""],Title:[e.name||""],FeatureTypeStyle:[{Rule:r}]}]}]}}},e.prototype.getSldRulesFromRules=function(e){var r=this;return e.map((function(e){var t={Name:[e.name]};if(e.filter){var o=r.getSldFilterFromFilter(e.filter);t.Filter=o}if(e.scaleDenominator){var a=e.scaleDenominator,i=a.min,l=a.max;i&&n(i)&&(t.MinScaleDenominator=[i.toString()]),l&&n(l)&&(t.MaxScaleDenominator=[l.toString()])}var s=r.getSldSymbolizersFromSymbolizers(e.symbolizers),c=[];return s.length>0&&(c=Object.keys(s[0])),c.forEach((function(e){0===s[0][e].length&&delete s[0][e]})),s.length>0&&0!==Object.keys(s[0]).length&&(t=Object.assign(t,s[0])),t}))},e.prototype.getSldSymbolizersFromSymbolizers=function(e){var r=this,t=[],o={};return e.forEach((function(e){var a;switch(e.kind){case"Mark":o.PointSymbolizer||(o.PointSymbolizer=[]),a=r.getSldPointSymbolizerFromMarkSymbolizer(e),l(a,"PointSymbolizer[0]")&&o.PointSymbolizer.push(l(a,"PointSymbolizer[0]"));break;case"Icon":o.PointSymbolizer||(o.PointSymbolizer=[]),a=r.getSldPointSymbolizerFromIconSymbolizer(e),l(a,"PointSymbolizer[0]")&&o.PointSymbolizer.push(l(a,"PointSymbolizer[0]"));break;case"Text":o.TextSymbolizer||(o.TextSymbolizer=[]),a=r.getSldTextSymbolizerFromTextSymbolizer(e),l(a,"TextSymbolizer[0]")&&o.TextSymbolizer.push(l(a,"TextSymbolizer[0]"));break;case"Line":o.LineSymbolizer||(o.LineSymbolizer=[]),a=r.getSldLineSymbolizerFromLineSymbolizer(e),l(a,"LineSymbolizer[0]")&&o.LineSymbolizer.push(l(a,"LineSymbolizer[0]"));break;case"Fill":o.PolygonSymbolizer||(o.PolygonSymbolizer=[]),a=r.getSldPolygonSymbolizerFromFillSymbolizer(e),l(a,"PolygonSymbolizer[0]")&&o.PolygonSymbolizer.push(l(a,"PolygonSymbolizer[0]"));break;case"Raster":o.RasterSymbolizer||(o.RasterSymbolizer=[]),a=r.getSldRasterSymbolizerFromRasterSymbolizer(e),l(a,"RasterSymbolizer[0]")&&o.RasterSymbolizer.push(l(a,"RasterSymbolizer[0]"))}t.push(o)})),t},e.prototype.getSldTextSymbolizerFromTextSymbolizer=function(e){var r=[{Label:e.label?this.getSldLabelFromTextSymbolizer(e.label):void 0}],t={font:"font-family",size:"font-size",fontStyle:"font-style",fontWeight:"font-weight"},o=Object.keys(e).filter((function(e){return"kind"!==e&&t[e]})).map((function(r){return{_:"font"===r?e[r][0]:e[r],$:{name:t[r]}}}));if(o.length>0&&(r[0].Font=[{CssParameter:o}]),e.offset||void 0!==e.rotate){var a=[{}];e.offset&&(a[0].Displacement=[{DisplacementX:[e.offset[0].toString()],DisplacementY:[e.offset[1].toString()]}]),void 0!==e.rotate&&(a[0].Rotation=[e.rotate.toString()]),r[0].LabelPlacement=[{PointPlacement:a}]}if(e.color&&(r[0].Fill=[{CssParameter:[{_:e.color,$:{name:"fill"}}]}]),e.haloWidth||e.haloColor){var i={},n=[];e.haloWidth&&(i.Radius=[e.haloWidth.toString()]),e.haloColor&&n.push({_:e.haloColor,$:{name:"fill"}}),n.length>0&&(i.Fill=[{CssParameter:n}]),r[0].Halo=[i]}return{TextSymbolizer:r}},e.prototype.getSldPolygonSymbolizerFromFillSymbolizer=function(e){var r,t={outlineColor:"stroke",outlineWidth:"stroke-width",outlineOpacity:"stroke-opacity",outlineDasharray:"stroke-dasharray"},o={color:"fill",fillOpacity:"fill-opacity"},a=[],i=[];l(e,"graphicFill")&&("Mark"===l(e,"graphicFill.kind")?r=this.getSldPointSymbolizerFromMarkSymbolizer(e.graphicFill):"Icon"===l(e,"graphicFill.kind")&&(r=this.getSldPointSymbolizerFromIconSymbolizer(e.graphicFill))),Object.keys(e).filter((function(e){return"kind"!==e})).filter((function(r){return void 0!==e[r]&&null!==e[r]})).forEach((function(r){if(Object.keys(o).includes(r))i.push({_:e[r],$:{name:o[r]}});else if(Object.keys(t).includes(r)){var n="";if("outlineDasharray"===r){var l=e[r];n="",l.forEach((function(e,r){n+=e,r<l.length-1&&(n+=" ")}))}else n="outlineWidth"===r||"outlineOpacity"===r?e[r]+"":e[r];a.push({_:n,$:{name:t[r]}})}}));var n=[{}];return(i.length>0||r)&&(n[0].Fill=[{}],r&&(n[0].Fill[0].GraphicFill=[r.PointSymbolizer[0]]),i.length>0&&(n[0].Fill[0].CssParameter=i)),a.length>0&&(n[0].Stroke=[{CssParameter:a}]),{PolygonSymbolizer:n}},e.prototype.getSldLineSymbolizerFromLineSymbolizer=function(e){var r={color:"stroke",width:"stroke-width",opacity:"stroke-opacity",join:"stroke-linejoin",cap:"stroke-linecap",dasharray:"stroke-dasharray",dashOffset:"stroke-dashoffset"},t={LineSymbolizer:[{Stroke:[{}]}]},o=Object.keys(e).filter((function(t){return"kind"!==t&&r[t]&&void 0!==e[t]&&null!==e[t]})).map((function(t){var o=e[t];return"dasharray"===t&&(o=e.dasharray?e.dasharray.join(" "):void 0),"join"===t&&"miter"===o&&(o="mitre"),{_:o,$:{name:r[t]}}})),a=e.perpendicularOffset;if(l(e,"graphicStroke"))if("Mark"===l(e,"graphicStroke.kind")){var i=this.getSldPointSymbolizerFromMarkSymbolizer(e.graphicStroke);t.LineSymbolizer[0].Stroke[0].GraphicStroke=[i.PointSymbolizer[0]]}else"Icon"===l(e,"graphicStroke.kind")&&(i=this.getSldPointSymbolizerFromIconSymbolizer(e.graphicStroke),t.LineSymbolizer[0].Stroke[0].GraphicStroke=[i.PointSymbolizer[0]]);if(l(e,"graphicFill"))if("Mark"===l(e,"graphicFill.kind")){var n=this.getSldPointSymbolizerFromMarkSymbolizer(e.graphicFill);t.LineSymbolizer[0].Stroke[0].GraphicFill=[n.PointSymbolizer[0]]}else"Icon"===l(e,"graphicFill.kind")&&(n=this.getSldPointSymbolizerFromIconSymbolizer(e.graphicFill),t.LineSymbolizer[0].Stroke[0].GraphicFill=[n.PointSymbolizer[0]]);return 0!==o.length&&(t.LineSymbolizer[0].Stroke[0].CssParameter=o),a&&(t.LineSymbolizer[0].PerpendicularOffset=[a]),t},e.prototype.getSldPointSymbolizerFromMarkSymbolizer=function(e){var r=[{WellKnownName:[e.wellKnownName.toLowerCase()]}];if(e.color||e.fillOpacity){var t=[];e.color&&t.push({_:e.color,$:{name:"fill"}}),e.fillOpacity&&t.push({_:e.fillOpacity,$:{name:"fill-opacity"}}),r[0].Fill=[{CssParameter:t}]}if(e.strokeColor||e.strokeWidth||e.strokeOpacity){r[0].Stroke=[{}];var o=[];e.strokeColor&&o.push({_:e.strokeColor,$:{name:"stroke"}}),e.strokeWidth&&o.push({_:e.strokeWidth.toString(),$:{name:"stroke-width"}}),e.strokeOpacity&&o.push({_:e.strokeOpacity.toString(),$:{name:"stroke-opacity"}}),r[0].Stroke[0].CssParameter=o}var a=[{Mark:r}];return e.opacity&&(a[0].Opacity=[e.opacity.toString()]),e.radius&&(a[0].Size=[(2*e.radius).toString()]),e.rotate&&(a[0].Rotation=[e.rotate.toString()]),{PointSymbolizer:[{Graphic:a}]}},e.prototype.getSldPointSymbolizerFromIconSymbolizer=function(e){var r=[{ExternalGraphic:[{OnlineResource:[{$:{"xlink:type":"simple","xmlns:xlink":"http://www.w3.org/1999/xlink","xlink:href":e.image}}]}]}];if(e.image){var t=e.image.split(".").pop();switch(t){case"png":case"jpeg":case"gif":r[0].ExternalGraphic[0].Format=["image/".concat(t)];break;case"jpg":r[0].ExternalGraphic[0].Format=["image/jpeg"];break;case"svg":r[0].ExternalGraphic[0].Format=["image/svg+xml"]}}return void 0!==e.opacity&&(r[0].Opacity=e.opacity),e.size&&(r[0].Size=e.size),e.rotate&&(r[0].Rotation=e.rotate),{PointSymbolizer:[{Graphic:r}]}},e.prototype.getSldRasterSymbolizerFromRasterSymbolizer=function(e){var r,t,o,a,i=[{}];return void 0!==e.opacity&&(r=[e.opacity.toString()],i[0].Opacity=r),e.colorMap&&(t=this.getSldColorMapFromColorMap(e.colorMap),c(t[0])||(i[0].ColorMap=t)),e.channelSelection&&(o=this.getSldChannelSelectionFromChannelSelection(e.channelSelection),c(o[0])||(i[0].ChannelSelection=o)),e.contrastEnhancement&&(a=this.getSldContrastEnhancementFromContrastEnhancement(e.contrastEnhancement),c(a[0])||(i[0].ContrastEnhancement=a)),{RasterSymbolizer:i}},e.prototype.getSldColorMapFromColorMap=function(e){var r=[{$:{}}];if(e.type){var t=e.type;r[0].$.type=t}if(void 0!==e.extended){var o=e.extended.toString();r[0].$.extended=o}if(e.colorMapEntries&&e.colorMapEntries.length>0){var a=e.colorMapEntries.map((function(e){var r={$:{}};return e.color&&(r.$.color=e.color),void 0!==e.quantity&&(r.$.quantity=e.quantity.toString()),e.label&&(r.$.label=e.label),void 0!==e.opacity&&(r.$.opacity=e.opacity.toString()),r})).filter((function(e){return Object.keys(e.$).length>0}));r[0].ColorMapEntry=a}return r},e.prototype.getSldChannelSelectionFromChannelSelection=function(e){var r=this,t={redChannel:"RedChannel",blueChannel:"BlueChannel",greenChannel:"GreenChannel",grayChannel:"GrayChannel"},o=Object.keys(e),a=[{}];return o.forEach((function(o){var i=[{}],n=l(e,"".concat(o,".sourceChannelName")),s=l(e,"".concat(o,".contrastEnhancement"));(n||s)&&(n&&(i[0].SourceChannelName=[n]),s&&(i[0].ContrastEnhancement=r.getSldContrastEnhancementFromContrastEnhancement(s)),a[0][t[o]]=i)})),a},e.prototype.getSldContrastEnhancementFromContrastEnhancement=function(e){var r=[{}],t=l(e,"enhancementType");return"normalize"===t?r[0].Normalize=[""]:"histogram"===t&&(r[0].Histogram=[""]),void 0!==e.gammaValue&&(r[0].GammaValue=[e.gammaValue.toString()]),r},e.prototype.getSldStrMatchesFunctionFromFunctionFilter=function(e){return{$:{name:"strMatches"},PropertyName:[e[1]],Literal:[e[2].toString().replace(/\//g,"")]}},e.prototype.getSldFunctionFilterFromFunctionFilter=function(e){if("strMatches"===e[0].split("FN_")[1])return this.getSldStrMatchesFunctionFromFunctionFilter(e)},e.prototype.getSldComparisonFilterFromComparisonFilter=function(r){var t,o,a,i={},n=r[0],l=r[1],s=r[2],c=e.keysByValue(e.comparisonMap,n),m=c.length>1&&null===s?c[1]:c[0],p="PropertyName";return Array.isArray(l)&&l[0].startsWith("FN_")&&(l=this.getSldFunctionFilterFromFunctionFilter(l),p="Function"),i[m]="PropertyIsNull"===m?[(t={},t[p]=[l],t)]:"PropertyIsLike"===m?[(o={$:{wildCard:"*",singleChar:".",escape:"!"}},o[p]=[l],o.Literal=[s],o)]:[(a={},a[p]=[l],a.Literal=[s],a)],i},e.prototype.getSldFilterFromFilter=function(r){var t=this,o={},a=r[0],i=r.slice(1);if(Object.values(e.comparisonMap).includes(a))o=this.getSldComparisonFilterFromComparisonFilter(r);else if(Object.values(e.combinationMap).includes(a)){var n=e.keysByValue(e.combinationMap,a)[0];o[n]=[{}],i.forEach((function(e,r){var a=t.getSldFilterFromFilter(e),i=Object.keys(a)[0];if("||"===e[0]||"&&"===e[0]){["And","Or"].includes(i)?(o[n][0][i]||(o[n][0][i]=[]),o[n][0][i][r]={}):o[n][0][i]={};var l=Object.keys(a)[0];e.forEach((function(e,a){if(a>0){var i=t.getSldFilterFromFilter(e),s=Object.keys(i)[0];o[n][0][l][r]||(o[n][0][l][r]={}),o[n][0][l][r][s]||(o[n][0][l][r][s]=[]),o[n][0][l][r][s].push(i[s][0])}}))}else Array.isArray(o[n][0][i])?o[n][0][i].push(a[i][0]):o[n][0][i]=a[i]}))}else Object.values(e.negationOperatorMap).includes(a)&&(o.Not=i.map((function(e){return t.getSldFilterFromFilter(e)})));return o},e.title="SLD Style Parser",e.negationOperatorMap={Not:"!"},e.combinationMap={And:"&&",Or:"||",PropertyIsBetween:"&&"},e.comparisonMap={PropertyIsEqualTo:"==",PropertyIsNotEqualTo:"!=",PropertyIsLike:"*=",PropertyIsLessThan:"<",PropertyIsLessThanOrEqualTo:"<=",PropertyIsGreaterThan:">",PropertyIsGreaterThanOrEqualTo:">=",PropertyIsNull:"=="},e}();r.SldStyleParser=m,r.default=m}}]);